<!DOCTYPE HTML>
<html lang="pl-PL" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Getting Started: Serving Web Content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="../static/css/style.css" th:href="@{/css/style.css}" type="text/css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script>
        /*<![CDATA[*/
        var mountainRanges = null;
        var mountainGroups = null;
        var data = [];

        var localizationsList = [];

        function changeMountainRangesListener() {
            var mountainRangesSelector = document.getElementById("mountainRangesSelectList");
            var mountainGroupsSelector = document.getElementById("mountainGroupsSelectList");

            console.log(mountainRangesSelector.innerHTML);
            var length = mountainGroupsSelector.options.length;
            for (i = 0; i < length; i++) {
                mountainGroupsSelector.options[i] = null;
            }

            length = data.length;
            for (i = 0; i < length; i++) {
                console.log(typeof data[i].mountainRange.id);
                console.log(data[i].mountainRange.id);
                console.log(typeof mountainRangesSelector.options.selectedIndex);
                console.log(mountainRangesSelector.options.selectedIndex);
                console.log(data[i].mountainRange.id == mountainRangesSelector.options.selectedIndex);
                if (data[i].mountainRange.id == mountainRangesSelector.options.selectedIndex) {
                    console.log("aaaadddd");
                    var option = document.createElement("option");
                    option.text = data[i].name;
                    option.value = data[i].id;
                    mountainGroupsSelector.add(option);
                }
            }

            console.log(data);
        }

        /*]]>*/
    </script>

    <script th:each="item:${mountainGroups}" th:inline="javascript">
        data.push([[${item}]]);
    </script>

    <script type="text/javascript">

        function remove() {
            console.log("remove call");
        }

        function add() {
            var otherLocations = document.getElementById("otherLocations");
            var tr = document.createElement("tr");
            var td = document.createElement("td");
            console.log(otherLocations);
            td.innerText = otherLocations.options[otherLocations.selectedIndex].text;
            tr.appendChild(td);

            var a = document.createElement("a");
            var img = document.createElement("img");
            img.src = "../static/images/minus.png";
            a.href = "javascript:remove();";
            a.appendChild(img);
            img.setAttribute("src", "/images/minus.png");
            img.width = 10;
            td.appendChild(a);

            document.getElementById("other_locations").appendChild(tr);
            localizationsList.push(otherLocations.options[otherLocations.selectedIndex].value);
        }

        $(document).ready(function () {
            $("#find_button").click(function (e) {
                e.preventDefault();
                $.post({
                    url: "/route/localizationOthers",
                    data: JSON.stringify(localizationsList),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function () {
                        console.log("wazne");
                        $("#criteria_form").submit();
                    }
                });
            });
        });



    </script>

</head>
<body>


<script>
    /*<![CDATA[*/
    mountainRanges = "[[${mountainRanges}]]";
    mountainGroups = "[[${mountainGroups}]]";
    console.log(mountainRanges);
    console.log(mountainGroups);
    /*]]>*/
</script>

<p class="header">
    <img class="header" src="../static/images/pttk_logo.jpg" th:src="@{/images/pttk_logo.jpg}" width="100"
         alt="Logo Pttk">
    Planowanie trasy
</p>

<form id="criteria_form" action="#" th:action="@{/route/find}" method="post">
    <table class="sections_details">
        <tr>
            <td class="align_right">Pasmo górskie:</td>
            <td>
                <select class="select_section_param" id="mountainRangesSelectList" name="mountainRange"
                        onchange="changeMountainRangesListener();">
                    <option></option>
                    <option th:each="mr : ${mountainRanges}"
                            th:value="${mr.getId()}" th:text="${mr.getName()}"></option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="align_right">Grupa górska:</td>
            <td>
                <select class="select_section_param" id="mountainGroupsSelectList" name="mountainGroup">
                    <option></option>
                    <option th:each="mg : ${mountainGroups}"
                            th:value="${mg.getId()}" th:text="${mg.getName()}"></option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="align_right">Lokalizacja startowa:</td>
            <td>
                <select class="select_section_param" name="locationStart">
                    <option></option>
                    <option th:each="l : ${locations}"
                            th:value="${l.getId()}" th:text="${l.getName()}"></option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="align_right">Lokalizacja końcowa:</td>
            <td>
                <select class="select_section_param" name="locationFinish">
                    <option></option>
                    <option th:each="l : ${locations}"
                            th:value="${l.getId()}" th:text="${l.getName()}"></option>
                </select>
            </td>
        </tr>
        <tr>
            <td class="align_right">
                <div>Lokalizacje pośrednie:</div>
                <div>
                    <a href="javascript:add()">
                        <img class="header" src="../static/images/plus.png"
                             th:src="@{/images/plus.png}" width="10" alt="Dodaj element">
                    </a>
                    <select class="select_section_param" id="otherLocations" name="otherLocation">
                        <option></option>
                        <option th:each="l : ${locations}"
                                th:value="${l.getId()}" th:text="${l.getName()}"></option>
                    </select>
                </div>
            </td>
            <td>
                <table class="other_localizations" id="other_locations">
                </table>
            </td>
        </tr>
        <tr>
            <td class="align_right">Punkty za odległość:</td>
            <td><input class="select_section_param" name="pointsDistance" type="number"></td>
        </tr>
        <tr>
            <td class="align_right">Punkty za wysokość:</td>
            <td><input class="select_section_param" name="pointsAltitude" type="number"></td>
        </tr>
        <tr>
            <td>
            </td>
            <td>
                <input id="find_button" class="select_section_param" type="button" value="Znajdź">
            </td>
        </tr>
    </table>
    <!--<input type="submit" value="Znajdź">-->
</form>
<p>
    <!--<a href="../home.html" th:href="@{/}">Return to home</a>-->
</p>
</body>
</html>